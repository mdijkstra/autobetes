<!DOCTYPE html>
<html>
    <head>
        <title>Autobetes App</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/jquery.mobile-1.4.2.css" />
        <!-- script src="/js/jquery-1.8.3.min.js"></script-->
        <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
        <script src="js/jquery.js"></script>
        <script src="js/jquery.mobile-1.4.2.js"></script>
        <script src="js/dbHandler.js"></script>
        <script src="js/restclient.js"></script>
        <script src="js/autobetes.js"></script>
        <script src="js/date.js"></script>
        
        <link rel="icon" href="img/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="css/autobetes.css" type="text/css">


        <!--link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
        <script src="/js/jquery-1.8.3.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/jquery.validate.min.js"></script> -->
    </head>
    <body>

        <input id="userId" type="hidden" value="1"/>

        <!-- Start of first page -->
        <div data-role="page" id="home">
			
            <div data-role="header" data-position="inline" data-position="fixed">
                <h1>Autobetes</h1>
                <a href="#settings" data-role="button" data-icon="gear" data-iconshadow="false"
                   data-direction="reverse" data-transition="flip"
                   data-iconpos="notext" class="ui-btn-right"></a>
            </div>

            <div role="main" id="mainScreen" class="ui-content">
                <a id = "homeStartButton" href="#start" class="ui-btn ui-icon-plus ui-btn-icon-left">Start event</a>
                <a id="historyButton" href="#history" class="ui-btn ui-btn-inline ui-icon-bullets ui-btn-icon-left">History</a>
                <p id="addedText"> <p>
                <H3>Current activity:</H3>
                
                <div class="event-list3" data-role="controlgroup" data-filter="true" data-input="#filterControlgroup-input">
                    
                </div>
            </div><!-- /content -->
			
			
			<div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home" class="ui-btn-active ui-state-persist">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->

        </div><!-- /page -->

        <div data-role="page" id="start">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all">Back</a>
                <h1>Start Event</a></h1>
                <div class="ui-btn-right">
                <a id="editModeButton" class="ui-btn ui-corner-all">Edit</a>
                <a id="newEventButton" href="#newEvent" class="ui-btn ui-icon-plus ui-btn-icon-right ui-btn-icon-notext ui-corner-all"></a>
                </div>
            	<div data-role="navbar">
                    <ul>
                        <li><a href="#" name="startEventTypeSelected">All</a></li>
                        <li><a href="#" name="startEventTypeSelected">Food</a></li>
                        <li><a href="#" name="startEventTypeSelected">Activity</a></li>
                    </ul>
                </div><!-- /navbar -->
                <form id="searchEventsInputForm">
                    <input data-type="search" id="filterControlgroup-input">
                </form>
            </div>
            <div data-role="main" class="ui-content" >
            	
            	<div id="recentlyAddedEvent" style="display: none">
            		<span id="eventNameToBePrivileged" style="display: none" ></span>
            		<span id="presentBoolean" style="display: none" >show</span>
            		<A id="recentAddedEventButton" CLASS="ui-btn ui-shadow ui-corner-all" style="background: #adf4b4"></A>
            	</div>
                <div id="event-list" data-role="controlgroup" data-filter="true" data-input="#filterControlgroup-input">
                </div>
            </div><!-- /content -->
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home" class="ui-btn-active ui-state-persist">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->
        </div><!-- /page -->

        <div data-role="page" id="start2">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all">Back</a>
                <H1>Add Event</H1>
                
                <a href="#newEvent" class="ui-btn ui-icon-plus ui-btn-icon-right ui-btn-icon-notext ui-corner-all"></a>
            </div><!-- /header -->

            <div role="main" class="ui-content">
                <H3 id="startEventName"></H3>
                <!-- input name="mode7" id="mode7" type="text" data-role="datebox" data-icon="grid" data-options='{"mode":"timeflipbox", "useNewStyle":true, "overrideTimeFormat": 24}' class="ui-input-text ui-body-d ui-corner-all ui-icon-grid" readonly="readonly"-->
                <table width="100%">
                    <tr>
                        <td width="50%">
                <input name="mydate" id="mydate" type="date" data-role="datebox"
                       data-options='{"mode": "timeflipbox"}'>
                        </td>
                        <td  width="50%">
                <input name="mydate" id="mytime" type="time" data-role="datebox"
                    data-options='{"mode": "timebox", "overrideTimeFormat": 24}'>
                        </td>
                    </tr>
                </table>
                <div class="ui-field-contain">
                    <label id="quantity" for="slider-2">Amount</label>
                    <input type="range" name="slider-2" id="slider-2" data-highlight="true" min="1" max="10" value="1" step="0.25">
                    <p><span id="intensityToText" style="display: none, color: blue">text</span></p>
                </div>
            </div><!-- /content -->
            
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home" class="ui-btn-active ui-state-persist">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->

        </div><!-- /page -->
        <div data-role="page" id="newEvent">
            <div data-role="header">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all">Back</a>
                <H1 id="headerName">New Event</H1>
            </div><!-- /header -->

            <div role="main" class="ui-content">
                <div>
                    <fieldset id="eventType" data-role="controlgroup" data-type="horizontal" style="text-align: center">
                        <input  type="radio" name="radio-choice-h-2" id="radio-choice-h-2a" value="Food">
                        <label for="radio-choice-h-2a">Food</label>
                        <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2b" value="Activity">
                        <label for="radio-choice-h-2b">Activity</label>
                    </fieldset>
                </div>
                <input id="newEventName" type="text" data-clear-btn="true" name="text-7"  value="" placeholder="Event name">
                <a id="addOrEditEvent" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-plus ui-btn-icon-left" data-rel="back">Add</a>
            	<p id="eventKey" style="display: none"><p>
            </div><!-- /content -->
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home" class="ui-btn-active ui-state-persist">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->
        </div><!-- /page -->
        
        
        <div data-role="page" data-id="settingsHeader" id="settings">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all" data-transition="flip">Back</a>
                <H1>Settings</H1>
                
            </div><!-- /header -->

            <div role="main" class="ui-content">
                <P>Pump serial:</P>
                <input id="pumpSerial" type="text" data-clear-btn="true" placeholder="1234567">
                <a href="#editSettings" class="ui-btn ui-btn-inline ui-icon-check ui-btn-icon-left ui-corner-all">Save</a>
            </div><!-- /content -->
        </div><!-- /page -->

       

        <div data-role="page" id="history">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all" data-transition="flip">Back</a>
                <H1>History</H1>
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" name="historyEventTypeSelected">All</a></li>
                        <li><a href="#" name="historyEventTypeSelected">Food</a></li>
                        <li><a href="#" name="historyEventTypeSelected">Activity</a></li>
                    </ul>
                </div><!-- /navbar -->
            </div><!-- /header -->

            <div role="main" class="ui-content">
                
                <div class="event-list2" data-role="controlgroup" data-filter="true" data-input="#filterControlgroup-input">
                    
                </div>
            </div><!-- /content -->
            <div style="display: none;" id="confirm-placeholder"><!-- placeholder for confirm --></div><!-- /popup -->
            <div class="ui-screen-hidden ui-popup-screen ui-overlay-inherit" id="confirm-screen"></div>
            <div class="ui-popup-container ui-popup-hidden ui-popup-truncate" id="confirm-popup">
                <div id="confirm" class="ui-content ui-popup ui-body-a ui-overlay-shadow ui-corner-all" data-role="popup" data-theme="a">
                    <p id="question">Are you sure you want to delete:</p>
                    <div class="ui-grid-a">
                        <div class="ui-block-a">
                            <a id="yes" class="ui-btn ui-corner-all ui-mini ui-btn-a" data-rel="back">Yes</a>
                        </div>
                        <div class="ui-block-b">
                            <a id="cancel" class="ui-btn ui-corner-all ui-mini ui-btn-a" data-rel="back">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home" class="ui-btn-active ui-state-persist">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->
        </div>
        
        
        <div data-role="page" id="editScreen">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all" data-transition="flip">Back</a>
                <H1>Edit</H1>
                
            </div><!-- /header -->

            <div role="main" class="ui-content">
                <H3 id="startEventName2">Begin</H3>
                <!-- input name="mode7" id="mode7" type="text" data-role="datebox" data-icon="grid" data-options='{"mode":"timeflipbox", "useNewStyle":true, "overrideTimeFormat": 24}' class="ui-input-text ui-body-d ui-corner-all ui-icon-grid" readonly="readonly"-->
                
                
                <table width="100%">
                    <tr>
                        <td width="50%">
                <input name="mydate" id="mydate2" type="date" data-role="datebox"
                       data-options='{"mode": "timeflipbox"}'>
                        </td>
                        <td width="50%">
                <input name="mytime" id="beginTime" type="time" data-role="datebox"
                    data-options='{"mode": "timebox", "overrideTimeFormat": 24}'>
                        </td>
                    </tr>
                </table>
                <div id="endTimeField" style="display:none;">
                    <table width ="100%">
                    <tr>
                        <td width="50%">
                    <p>End time:</p>
                        </td>
                        <td width="50%">
                    <input name="mytime" id="endTime" type="time" data-role="datebox"
                    data-options='{"mode": "timebox", "overrideTimeFormat": 24}'>
                        </td>
                    <tr>
                    </table>
                </div>
               
                
                <div class="ui-field-contain">
                    <label id="quantity2" for="slider-3">Amount</label>
                    <input type="range" name="slider-3" id="slider-3" data-highlight="true" min="1" max="10" value="1" step="1" >
                    <p><span id="intensityToText2" style="display: none, color:blue">Light</span></p>
                </div>
              
            </div><!-- /content -->
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home" class="ui-btn-active ui-state-persist">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->
        </div>
        
           <div data-role="page" id="report">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all">Back</a>
                <H1>Reports</H1>
                <a href="#newEvent" class="ui-btn ui-icon-plus ui-btn-icon-right ui-btn-icon-notext ui-corner-all"></a>
            </div><!-- /header -->

            
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home">Input</a></li>
			<li><a href="#report" class="ui-btn-active ui-state-persist">Report</a></li>
			<li><a href="#pumpSettings">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->

        </div><!-- /page -->

         <div data-role="page" id="pumpSettings">
            <div data-role="header" data-position="fixed">
                <a data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left ui-btn-icon-notext ui-corner-all">Back</a>
                <H1>Pump settings</H1>
                <a href="#newEvent" class="ui-btn ui-icon-plus ui-btn-icon-right ui-btn-icon-notext ui-corner-all"></a>
            </div><!-- /header -->

            
            <div data-role="footer" data-id="foo1" data-position="fixed" class="ui-footer ui-bar-a ui-footer-fixed slideup">
	<div data-role="navbar">
		<ul>
			<li><a href="#home">Input</a></li>
			<li><a href="#report">Report</a></li>
			<li><a href="#pumpSettings" class="ui-btn-active ui-state-persist">Pump settings</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->

        </div><!-- /page -->		
        
        <!-- /content -->
    <!-- /page -->
    
    <div data-role="page" id="deleteDialog" data-position="window">
    	<div data-role="header">
    		<h1>Delete event</h1>
    	</div>
    	<div data-role="content">
    		<p id="dialogText"></p>
    		<a id="dialogConfirmButton" data-role="button" data-rel="back" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-shadow ui-btn-corner-all ui-btn-up-b">
    			<span class="ui-btn-inner ui-btn-corner-all">
    				<span class="ui-btn-text">Yes</span>
    			</span>
    		</a>
    		<a data-role="button" data-rel="back" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-shadow ui-btn-corner-all ui-btn-up-b">
    			<span class="ui-btn-inner ui-btn-corner-all">
    				<span class="ui-btn-text">No</span>
    			</span>
    		</a>
    	</div>
    </div>
    <script type="text/javascript" charset="utf-8">
      
        
        var db = new dbHandler('autoB', '1.0', 'Autobetes', 1000000);
        var restClient = new top.molgenis.RestClient();
        $('#editScreen').page();
        $('#editScreenActivity').page();
        $('#start2').page();
        $('#newEvent').page();
       
        var token;
        
        $(function() {
          onDeviceReady();
        })
        
        
        // Wait for PhoneGap to load
        // 
        document.addEventListener("deviceready", onDeviceReady, false);



        // PhoneGap is loaded and it is now safe to make calls PhoneGap methods
        //
         function onDeviceReady() {
             
            
            getToken();
            
             document.addEventListener("offline", function(e) {
                 alert("offline");
             }, false);
                                       
             document.addEventListener("online", function(e) {
            	 db.sendDbData();
                 alert("online");
             }, false);
             
            
        }
    
    function getToken(){
 
       restClient.login('admin', 'admin', {
                        success: function(result){
                            
                        token = result.token;
						
                        }
                
            });
       }
    
		
        function getEvents(eventType) {

            if (eventType !== null && eventType !== undefined) {
                
                db.listEventsOfEventType(eventType.toLowerCase());
                
            }
            else{
                db.listAllEvents();
            }
          //hide the green button on top of the list
        	if($('#presentBoolean').text() === 'hide'){
        		$('#recentlyAddedEvent').hide();
        	}
            
        }

        function selectTabMenu() {
            
            var selectedTabIndex = $(document).data('selectedTabIndex');
            var index = selectedTabIndex === undefined ? 0 : selectedTabIndex.index;
            var eventType = selectedTabIndex === undefined ? null : selectedTabIndex.eventType;
            $('[name=startEventTypeSelected]').removeClass('ui-btn-active');
            $('[name=startEventTypeSelected]:eq(' + index + ')').addClass('ui-btn-active');
            //console.log('in selectTabMenu, eventType: ' + eventType);
            
            getEvents(eventType);
          
        }
    
    function selectHistoryTabMenu() {
        
        var selectedTabIndex = $(document).data('selectedTabIndex2');
        var index = selectedTabIndex === undefined ? 0 : selectedTabIndex.index;
        var eventType = selectedTabIndex === undefined ? null : selectedTabIndex.eventType;
        $('[name=historyEventTypeSelected]').removeClass('ui-btn-active');
        $('[name=historyEventTypeSelected]:eq(' + index + ')').addClass('ui-btn-active');
        db.listHistoryEvents(eventType);
    }


        $('[name=startEventTypeSelected]').click(function() {
            
            var eventType = $(this).html() === 'All' ? null : $(this).html();
            var index = 0;
            if (eventType === 'Food')
                index = 1;
            else if (eventType === 'Activity')
                index = 2;
            $(document).data('selectedTabIndex', {
                'index': index,
                'eventType': eventType
            });
            
            getEvents(eventType);
        });
        
        $('[name=historyEventTypeSelected]').click(function() {
             var eventType = $(this).html() === 'All' ? null : $(this).html();
             var index = 0;
            if (eventType === 'Food')
                  index = 1;
              else if (eventType === 'Activity')
                   index = 2;
                $(document).data('selectedTabIndex2', {
              'index': index,
               'eventType': eventType
            });
                                                   
             db.listHistoryEvents($(this).html());
            
        });
        

        $('#addOrEditEvent').click(function() {
            //alert('start adding');
            var eventName = $('#newEventName').val();
            var eventType = $('[name="radio-choice-h-2"]:checked').val().toLowerCase();
            if($('#addOrEditEvent').text() === 'Add'){
            	//add event
            	db.addEvent($('#newEventName').val(),$('[name="radio-choice-h-2"]:checked').val().toLowerCase());
            }
            else{
            	//edit event 
            	var eventKey = $('#eventKey').text();
            	db.editEvent(eventKey, eventName, eventType);
            }
           
        });
        $('#historyButton').click(function() {
                $(document).removeData('selectedTabIndex2');
                selectHistoryTabMenu();
                $('.event-list2').html('');//empty list
            
         });
        
        $('#editModeButton').click(function(){
        	
        	if($('#editModeButton').val() ==="on"){
        		//editmode was on, now need to be turned off
        		$('#editModeButton').val('off');
        		$('#editModeButton').attr("style","");
        		$('.eventButtons').attr("style","");
        		
        		//change buttontext to Add on newEvent screen
        		$('#addOrEditEvent').text('Add');
        		$('#addOrEditEvent').attr('class', 'ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-plus ui-btn-icon-left');
        	}
        	else{
        		//editmode was off, now need to be turned on
        		$('#editModeButton').val('on');
        		$('#editModeButton').attr("style","background: #8df3e6 !important");
        		$('.eventButtons').attr("style","background: #8df3e6 !important");
        		
        		//change buttontext to Edit on newEvent screen
        		$('#addOrEditEvent').text('Save');
        		$('#addOrEditEvent').attr('class', 'ui-btn ui-corner-all ui-shadow ui-btn-inline');

        		
        	}
        	
        	
        });
        
        $('#newEventButton').click(function(){
        	$('#addOrEditEvent').text('Add');
        	$('#addOrEditEvent').attr('class', 'ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-plus ui-btn-icon-left');
			$('#headerName').text('New Event');
			
			/*
        	Autoselect 'Food' or 'Activity' when adding new event, based on selection 
        	that was active in 'Event view' (blue bars in top of screen)
        	*/
        	var selectedTabIndex = $(document).data('selectedTabIndex');
            var index = selectedTabIndex === undefined ? 0 : selectedTabIndex.index;
           
            if(index === 0 || index === 1){
            	
            	$("#radio-choice-h-2a").prop("checked", true);
            	$("#radio-choice-h-2b").prop("checked",false);
                $("input[type='radio']").checkboxradio("refresh");
            }
            else{
            	
        		$("#radio-choice-h-2b").prop("checked", true);
        		$("#radio-choice-h-2a").prop("checked", false);
            	$("input[type='radio']").checkboxradio("refresh");
        	}
        })
        $('#recentAddedEventButton').click(function(){
					
			db.setRightScreen(this);
		});

        $(document).on('pageshow', '#start', function() {
        	//set tab index on the "All" tab when the page will be showed
        	$(document).data('selectedTabIndex', {
                'index': 0,
                'eventType': null
            });
        	
        	
            selectTabMenu();
        });
      

        
        $(document).on('pageshow', '#home', function() {
                       
                db.listCurrentEvents();
        });
        
        $(document).on('pageshow', '#history', function() {
            selectHistoryTabMenu();
            //db.listCurrentEvents();
         });
        
        $(document).on('pagehide', '#newEvent', function(){
        	//empty eventname field
            $('#newEventName').val('');
        });
        $(document).on('pagehide', '#start', function(){
        	//ensure the button with the new event(in green) will be hidden
        	$('#recentlyAddedEvent').hide();
        	//get out of edit mode
        	$('#editModeButton').val('off');
    		$('#editModeButton').attr("style","");
    		$('.eventButtons').attr("style","");
    		
        });
        
        
        
     
    </script>


</body>
</html>
